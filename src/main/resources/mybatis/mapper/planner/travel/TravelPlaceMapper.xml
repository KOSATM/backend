<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.example.demo.planner.travel.dao.TravelPlaceMapper">

  <select id="selectTravelPlaceById" parameterType="long" resultType="com.example.demo.planner.travel.dto.entity.TravelPlace">
    SELECT id, day_id, title, start_at, end_at, place_name, address, lat, lng, expected_cost
    FROM plan_places
    WHERE id = #{id}
  </select>

  <select id="selectTravelPlacesByDayId" parameterType="long" resultType="com.example.demo.planner.travel.dto.entity.TravelPlace">
    SELECT id, day_id, title, start_at, end_at, place_name, address, lat, lng, expected_cost
    FROM plan_places
    WHERE day_id = #{dayId}
    ORDER BY start_at ASC
  </select>

  <select id="selectTravelPlacesByPlanId" parameterType="long" resultType="com.example.demo.planner.travel.dto.entity.TravelPlace">
    SELECT tp.id, tp.day_id, tp.title, tp.start_at, tp.end_at, tp.place_name, tp.address, tp.lat, tp.lng, tp.expected_cost
    FROM plan_places tp
    INNER JOIN travel_days td ON tp.day_id = td.id
    WHERE td.travel_plan_id = #{travelPlanId}
    ORDER BY td.day_index ASC, tp.start_at ASC
  </select>

  <insert id="insertTravelPlace" parameterType="com.example.demo.planner.travel.dto.entity.TravelPlace" useGeneratedKeys="true" keyProperty="id" keyColumn="id">
    INSERT INTO plan_places (day_id, title, start_at, end_at, place_name, address, lat, lng, expected_cost)
    VALUES (#{dayId}, #{title}, #{startAt}, #{endAt}, #{placeName}, #{address}, #{lat}, #{lng}, #{expectedCost})
  </insert>

  <update id="updateTravelPlace" parameterType="com.example.demo.planner.travel.dto.entity.TravelPlace">
    UPDATE plan_places
    SET day_id = #{dayId},
        title = #{title},
        start_at = #{startAt},
        end_at = #{endAt},
        place_name = #{placeName},
        address = #{address},
        lat = #{lat},
        lng = #{lng},
        expected_cost = #{expectedCost}
    WHERE id = #{id}
  </update>

  <delete id="deleteTravelPlace" parameterType="long">
    DELETE FROM plan_places
    WHERE id = #{id}
  </delete>

  <delete id="deleteTravelPlacesByDayId" parameterType="long">
    DELETE FROM plan_places
    WHERE day_id = #{dayId}
  </delete>

</mapper>
