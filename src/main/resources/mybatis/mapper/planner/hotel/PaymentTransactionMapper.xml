<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.example.demo.planner.hotel.dao.PaymentTransactionDao">

  <select id="selectPaymentTransactionById" resultType="com.example.demo.planner.hotel.dto.entity.PaymentTransaction">
    SELECT id, hotel_booking_id, payment_method, provider_payment_id, amount, currency, status,
           requested_at, completed_at, cancelled_at, raw_response, created_at, updated_at
    FROM payment_transactions WHERE id = #{id}
  </select>

  <insert id="insertPaymentTransaction" parameterType="com.example.demo.planner.hotel.dto.entity.PaymentTransaction" useGeneratedKeys="true" keyProperty="id" keyColumn="id">
    INSERT INTO payment_transactions (hotel_booking_id, payment_method, provider_payment_id, amount, currency, status,
           requested_at, completed_at, cancelled_at, raw_response, created_at, updated_at)
    VALUES (#{hotelBookingId}, #{paymentMethod}, #{providerPaymentId}, #{amount}, #{currency}, #{status},
           #{requestedAt,jdbcType=TIMESTAMP_WITH_TIMEZONE}, #{completedAt,jdbcType=TIMESTAMP_WITH_TIMEZONE}, #{cancelledAt,jdbcType=TIMESTAMP_WITH_TIMEZONE}, #{rawResponse}, now(), now())
  </insert>

  <update id="updatePaymentTransaction" parameterType="com.example.demo.planner.hotel.dto.entity.PaymentTransaction">
    UPDATE payment_transactions
    SET hotel_booking_id = #{hotelBookingId}, payment_method = #{paymentMethod}, provider_payment_id = #{providerPaymentId},
        amount = #{amount}, currency = #{currency}, status = #{status}, requested_at = #{requestedAt,jdbcType=TIMESTAMP_WITH_TIMEZONE},
        completed_at = #{completedAt,jdbcType=TIMESTAMP_WITH_TIMEZONE}, cancelled_at = #{cancelledAt,jdbcType=TIMESTAMP_WITH_TIMEZONE}, raw_response = #{rawResponse}, updated_at = now()
    WHERE id = #{id}
  </update>

  <delete id="deletePaymentTransactionById" parameterType="long">
    DELETE FROM payment_transactions WHERE id = #{id}
  </delete>

</mapper>
